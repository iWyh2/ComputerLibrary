# MQ

## MQ基本概念

MQ：**Message Queue**（消息队列）

是在消息的传输过程中**保存消息的容器**，多用于分布式系统之间进行通信

* 分布式系统的两种通信方式：
  * 直接远程调用：子系统A ---> 子系统B
  * 借助第三方间接完成（这就是运用MQ）：生产者(发送方) ---> MQ ---> 消费者(接收方)



## MQ优势

* 应用解耦：使得应用间解耦，提升容错性和可维护性
* 异步提速：提升用户体验和系统吞吐量
* 削峰填谷：限制消费信息的速度，高峰期产生的消息会被积压在MQ中，直到被消费完，提高系统稳定性



## MQ劣势

* 系统可用性降低：系统引入的外部依赖越多，系统稳定性越差。需要保证MQ不会宕机，要保证MQ的高可用
* 系统复杂度提高：通过MQ进行异步调用，增加了系统的复杂度。要保证消息没有被重复消费，消息传递的顺序性
* 一致性问题：MQ同时给多个系统发送消息，一些成功，一些失败时，需要保证消息数据的处理一致性



## 使用MQ的条件

* 生产者不需要从消费者获得反馈。在引入消息队列之前的直接调用，其接口的返回值应该为空，才能让下层的动作还没做完，上层可以直接继续执行，也就是异步
* 可以容忍短暂的不一致
* 使用了MQ之后的收益，大于管理MQ的成本



## 常见MQ产品

|                |                 RabbitMQ                 |             ActiveMQ              |       RocketMQ       |       Kafka        |
| :------------: | :--------------------------------------: | :-------------------------------: | :------------------: | :----------------: |
|   公司/社区    |                  Rabbit                  |              Apache               |       阿里巴巴       |       Apache       |
|    开发语言    |                  Erlang                  |               Java                |         Java         |     Scala&Java     |
| 客户端支持语言 |     Erlang，Java，Ruby，几乎所有语言     |    Java，C/C++，Python，PHP等     |      Java，C++       |   Java，Python等   |
|   单机吞吐量   |               万级（其次）               |           万级（最差）            |    十万级（最好）    |   十万级（次之）   |
|    消息延迟    |                   微秒                   |               毫秒                |         毫秒         |        毫秒        |
|    功能特性    | 并发能力强，性能极其好，延时低，社区活跃 |    老牌产品，成熟度高，文档多     | MQ功能完备，扩展性好 | 只支持主要的MQ功能 |
|    协议支持    |         AMQP，XMPP，SMTP，STOMP          | OpenWire，STOMP，REST，XMPP，AMQP |        自定义        |       自定义       |